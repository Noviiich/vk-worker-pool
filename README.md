# Worker Pool

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø—É–ª –≤–æ—Ä–∫–µ—Ä–æ–≤ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –¥–æ–±–∞–≤–ª—è—Ç—å –∏ —É–¥–∞–ª—è—Ç—å –≤–æ—Ä–∫–µ—Ä—ã –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã. –†–µ—à–µ–Ω–∏–µ –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á —Ä–∞–∑–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏.

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```shell
git clone https://github.com/Noviiich/vk-worker-pool.git
cd vk-worker-pool
go run cmd/main.go
```

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- üöÄ **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–æ–≤ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- üîí **–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º—å—é—Ç–µ–∫—Å–æ–≤ –∏ –∫–∞–Ω–∞–ª–æ–≤ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- ‚è≥ **Graceful shutdown**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ
- üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ú–µ—Ç–æ–¥—ã –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤
- üì¶ **–ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á**: –ó–∞–¥–∞—á–∏ –ø–æ–º–µ—â–∞—é—Ç—Å—è –≤ –±—É—Ñ–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª
- üí° **–ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### `WorkerPool`
- `jobs`: –ö–∞–Ω–∞–ª –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–¥–∞—á (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ–±—ã—á–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏)
- `results`: –ö–∞–Ω–∞–ª –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- `workers`: –ö–∞—Ä—Ç–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤
- –ú–µ—Ç–æ–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
  - `AddWorker()`: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞
  - `RemoveWorker(id)`: –£–¥–∞–ª–µ–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–∞ –ø–æ ID
  - `SubmitJob(job)`: –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–¥–∞—á–∏ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É
  - `GetResult()`: –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
  - `Close()`: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø—É–ª–∞
  - `GetActiveWorkers()`: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤

### `Worker`
- –ê–≤—Ç–æ–Ω–æ–º–Ω–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–∞–Ω–∞–ª `quit` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º
- –ú–µ—Ç–æ–¥—ã:
  - `Start()`: –ó–∞–ø—É—Å–∫ —Ü–∏–∫–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
  - `ProcessJob()`: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á–∏
  - `Stop()`: –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—É–ª–∞
```go
pool := wpool.NewWorkerPool(10) // –ë—É—Ñ–µ—Ä –Ω–∞ 10 –∑–∞–¥–∞—á
defer pool.Close()              // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–æ–≤
```go
pool.AddWorker()
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–¥–∞—á
```go
pool.SubmitJob(job)
```

### –£–¥–∞–ª–µ–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–æ–≤
```go
pool.RemoveWorker(workerID)
```

### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–∞–º–∏
```go
time.Sleep(time.Millisecond * 200) // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏
pool.RemoveWorker(worker1)
fmt.Printf("–£–¥–∞–ª–µ–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–æ–≤, –∞–∫—Ç–∏–≤–Ω—ã—Ö: %d\n", pool.GetActiveWorkers())    

worker3 := pool.AddWorker()
worker4 := pool.AddWorker()
fmt.Printf("–î–æ–±–∞–≤–ª–µ–Ω—ã –≤–æ—Ä–∫–µ—Ä—ã, –∞–∫—Ç–∏–≤–Ω—ã—Ö: %d\n", pool.GetActiveWorkers())
...
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
```go
go func() {
    processedCount := 0
    for processedCount < len(jobs) {
        if result, ok := pool.GetResult(); ok {
            fmt.Printf("–†–µ–∑—É–ª—å—Ç–∞—Ç: %s\n", result)
            processedCount++
        } else {
            time.Sleep(time.Millisecond * 10)
        }
    }
}()
```
